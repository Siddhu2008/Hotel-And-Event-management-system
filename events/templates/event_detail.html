{% extends 'base.html' %}

{% block title %}{{ event.name }} | The Grand Retreat{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="row">
    <div class="col-md-6">
      <img src="{{ event.image.url }}" alt="{{ event.name }}" class="img-fluid rounded" style="width: 525px;">
    </div>
    <div class="col-md-6">
      <h2 class="fw-bold">{{ event.name }}</h2>
      <p class="text-muted">{{ event.description }}</p>
      <p><strong>Date:</strong> {{ event.date }}</p>
      <p><strong>Time:</strong> {{ event.time }}</p>
      <p><strong>Price:</strong> â‚¹{{ event.price }}</p>

      {% if event %}
        <span class="badge bg-success mb-2">Available</span>
        <button class="btn btn-gold w-100 book-btn" data-bs-toggle="modal" data-bs-target="#bookingModal"
          data-event-id="{{ event.id }}" data-event-name="{{ event.name }}" data-event-datetime="{{ event.date }} {{ event.time }}">
          Book Now
        </button>
      {% else %}
        <span class="badge bg-danger">Unavailable</span>
        <button class="btn btn-secondary w-100" disabled>Unavailable</button>
      {% endif %}
    </div>
  </div>

  <!-- Booking Modal -->
  <div class="modal fade" id="bookingModal" tabindex="-1" aria-labelledby="bookingModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content rounded-4 shadow">
        <div class="modal-header border-0">
          <h5 class="modal-title" id="bookingModalLabel">Book Your Spot</h5>
          <button type="button" class="btn-close btn-close-dark" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form method="POST">
            {% csrf_token %}
            <input type="hidden" name="event_id" id="event_id">
            <div class="mb-3">
              <label class="form-label">Event Name</label>
              <input type="text" id="event_name_display" class="form-control" readonly>
            </div>
            <div class="mb-3">
              <label class="form-label">Event Date & Time</label>
              <input type="text" id="event_datetime_display" class="form-control" readonly>
            </div>
            <div class="mb-3">
              <label class="form-label">Number of Guests</label>
              <input type="number" name="guests" class="form-control" min="1" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Additional Notes</label>
              <textarea name="notes" class="form-control" rows="3" placeholder="Optional details..."></textarea>
            </div>
            <div class="modal-footer border-0">
              <button type="submit" class="btn btn-gold w-100">Confirm Booking</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Script to fill modal with selected event info -->
  <script>
    document.querySelectorAll('.book-btn').forEach(button => {
      button.addEventListener('click', function () {
        const eventId = this.dataset.eventId;
        const eventName = this.dataset.eventName;
        const eventDatetime = this.dataset.eventDatetime;

        document.getElementById('event_id').value = eventId;
        document.getElementById('event_name_display').value = eventName;
        document.getElementById('event_datetime_display').value = eventDatetime;
      });
    });
  </script>
</div>
{% endblock %}
