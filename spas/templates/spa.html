{% extends 'base.html' %}

{% block title %}Rooms | The Grand Retreat{% endblock %}

{% block content %}
  <style>
    body {
      font-family: 'Open Sans', sans-serif;
      background-color: #fff;
    }

    h1, h2, h3 {
      font-family: 'Playfair Display', serif;
    }

    .hero-section {
      background: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)),
        url('https://tse3.mm.bing.net/th/id/OIP.IWKWY729KpAfvAcbPymTWAHaEK?pid=Api&P=0&h=180') center/cover no-repeat;
      color: #fff;
      padding: 120px 20px;
      text-align: center;
    }

    .btn-gold {
      background-color: #d4af37;
      color: #000;
      font-weight: 600;
      border-radius: 50px;
    }

    .btn-gold:hover {
      background-color: #b9982e;
      color: #fff;
    }

    .service-card {
      border: none;
      border-radius: 15px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      transition: transform 0.3s ease;
      cursor: pointer;
    }

    .service-card:hover {
      transform: translateY(-5px);
    }

    .service-card img {
      height: 200px;
      object-fit: cover;
    }

    .form-control:focus {
      border-color: #d4af37;
      box-shadow: none;
    }

    .footer-link {
      color: #ccc;
      text-decoration: none;
      transition: all 0.3s ease;
    }

    .modal-content {
      background-color: #1c1c1c;
      border-radius: 10px;
      color: white;
    }

    .nav-tabs .nav-link.active {
      background-color: transparent;
      border: none;
      color: #d4af37;
      font-weight: bold;
    }

    .nav-tabs .nav-link {
      color: #aaa;
    }
    .profile-card, .package-card {
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
      cursor: pointer;
    }

    .profile-card:hover, .package-card:hover {
      transform: translateY(-10px);
    }

    .faq-section .accordion-button {
      font-weight: bold;
      background-color: #f1f1f1;
    }

    .form-control {
      background-color: #2c2c2c;
      border: 1px solid #555;
      color: #fff;
    }

    .form-control:focus {
      border-color: #d4af37;
      box-shadow: none;
    }

    .footer-link {
      display: block;
      color: #ccc;
      margin-bottom: 0.5rem;
      transition: all 0.3s ease;
      text-decoration: none;
    }

    .footer-link:hover {
      color: #d4af37;
      padding-left: 5px;
    }

    .form-input {
      background-color: #fcfcfc;
      border: 1px solid #555;
      color: #080808;
    }

    .text-gold {
      color: #d4af37;
    }
  </style>
{% if messages %}
        <div class="mt-3">
          {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">{{ message }}</div>
          {% endfor %}
        </div>
      {% endif %}
  <!-- Hero Section -->
  <section class="hero-section">
    <div class="container">
      <h1 class="display-5 fw-bold">Luxury Spa & Wellness</h1>
      <p class="lead">Rejuvenate your body, mind, and soul</p>
      <a href="#booking" class="btn btn-gold mt-3 px-4">Book a Spa Session</a>
    </div>
  </section>

  <!-- Services -->
  <section class="container py-5">
    <h2 class="text-center mb-4">Our Signature Treatments</h2>
    <div class="row g-4">
      <div class="col-md-4" data-aos="fade-up">
        <div class="card service-card" data-service="Aroma Therapy" onclick="selectService('Aroma Therapy')">
          <img src="https://images.pexels.com/photos/3997995/pexels-photo-3997995.jpeg" class="card-img-top" alt="Massage">
          <div class="card-body">
            <h5 class="card-title">Aroma Therapy</h5>
            <p class="card-text text-muted">Relax with our scented oil massage and restore your energy.</p>
          </div>
        </div>
      </div>

      <div class="col-md-4" data-aos="fade-up">
        <div class="card service-card" data-service="Hydrating Facial" onclick="selectService('Hydrating Facial')">
          <img src="https://images.pexels.com/photos/3571554/pexels-photo-3571554.jpeg" class="card-img-top" alt="Facial">
          <div class="card-body">
            <h5 class="card-title">Hydrating Facial</h5>
            <p class="card-text text-muted">Glow naturally with our herbal and organic facial treatments.</p>
          </div>
        </div>
      </div>

      <div class="col-md-4" data-aos="fade-up">
        <div class="card service-card" data-service="Detox Body Wrap" onclick="selectService('Detox Body Wrap')">
          <img src="https://tse1.mm.bing.net/th/id/OIP.uhN2hPJhZesmijQ5j8bptwHaE8?pid=Api&P=0&h=180" class="card-img-top" alt="Body Wrap">
          <div class="card-body">
            <h5 class="card-title">Detox Body Wrap</h5>
            <p class="card-text text-muted">Cleanse toxins with rich mud therapy and skin rejuvenation wrap.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Therapist Profiles -->
  <section class="py-5">
    <div class="container">
      <h2 class="text-center mb-5">Meet Our Therapists</h2>
      <div class="row g-4">
        <div class="col-md-4" data-aos="fade-up">
          <div class="card profile-card">
            <img src="https://randomuser.me/api/portraits/women/45.jpg" class="card-img-top" alt="Therapist 1">
            <div class="card-body text-center">
              <h5 class="card-title">Aisha Mehra</h5>
              <p class="card-text text-muted">Aromatherapy Specialist</p>
            </div>
          </div>
        </div>
        <div class="col-md-4" data-aos="fade-up" data-aos-delay="150">
          <div class="card profile-card">
            <img src="https://randomuser.me/api/portraits/men/32.jpg" class="card-img-top" alt="Therapist 2">
            <div class="card-body text-center">
              <h5 class="card-title">Rahul Verma</h5>
              <p class="card-text text-muted">Deep Tissue Expert</p>
            </div>
          </div>
        </div>
        <div class="col-md-4" data-aos="fade-up" data-aos-delay="300">
          <div class="card profile-card">
            <img src="https://randomuser.me/api/portraits/women/45.jpg" class="card-img-top" alt="Therapist 3">
            <div class="card-body text-center">
              <h5 class="card-title">Nina Kapoor</h5>
              <p class="card-text text-muted">Reflexology Guru</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Packages -->
  <section class="py-5 bg-light">
    <div class="container">
      <h2 class="text-center mb-5">Our Spa Packages</h2>
      <div class="row g-4">
        <div class="col-md-4" data-aos="fade-right">
          <div class="card package-card p-4 text-center" onclick="selectService('Relax & Rejuvenate')">
            <h4>Relax & Rejuvenate</h4>
            <p class="text-muted">₹3,000</p>
            <ul class="list-unstyled small">
              <li>60-min Aromatherapy</li>
              <li>Steam & Sauna</li>
              <li>Herbal Tea</li>
            </ul>
          </div>
        </div>

        <div class="col-md-4" data-aos="fade-up">
          <div class="card package-card p-4 text-center" onclick="selectService('Luxury Retreat')">
            <h4>Luxury Retreat</h4>
            <p class="text-muted">₹5,500</p>
            <ul class="list-unstyled small">
              <li>90-min Deep Tissue</li>
              <li>Facial & Foot Massage</li>
              <li>Champagne & Fruit Platter</li>
            </ul>
          </div>
        </div>

        <div class="col-md-4" data-aos="fade-left">
          <div class="card package-card p-4 text-center" onclick="selectService(`Couple's Escape`)">
            <h4>Couple's Escape</h4>
            <p class="text-muted">₹8,000</p>
            <ul class="list-unstyled small">
              <li>Couple Massage</li>
              <li>Jacuzzi Session</li>
              <li>Candlelight Ambience</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Booking Form -->
  <section class="bg-light py-5" id="booking">
    <div class="container">
      <h2 class="text-center mb-4">Book Your Spa Appointment</h2>

      {% if services %}
      <form method="POST" action="{% url 'book_spa' %}" class="col-md-8 mx-auto" data-aos="fade-up">
        {% csrf_token %}

        <div class="mb-3">
          <label class="form-label">Preferred Date</label>
          <select name="date" id="date-select" class="form-select form-input" required>
            <option value="">Select a date</option>
            {% for date_option in date_choices %}
              <option value="{{ date_option|date:'Y-m-d' }}"
                {% if date_option == selected_date %}selected{% endif %}>
                {{ date_option|date:"D, M d, Y" }}
              </option>
            {% endfor %}
          </select>
        </div>

        <div class="mb-3">
          <label class="form-label">Select Treatment</label>
          <select id="service-select" name="service" class="form-select form-input" required>

  {% for service in services %}
    <option value="{{ service.id }}" {% if service == selected_service %}selected{% endif %}>{{ service.name }}</option>
  {% endfor %}
</select>

        </div>

        <div class="mb-3">
          <label class="form-label">Preferred Time</label>
          <label for="time-select">Select Time:</label>
<select id="time-select" name="time" class="form-select form-input" required>
  <option>Loading...</option>
</select>

        </div>

        <button type="submit" class="btn btn-gold w-100 mt-3">Confirm Appointment</button>
      </form>
      {% else %}
        <p class="text-center text-dark">No spa services available at the moment.</p>
      {% endif %}

      
    </div>
  </section>

  <script>
  function fetchAvailableSlots() {
    const date = document.getElementById('date-select').value;
    const serviceId = document.getElementById('service-select').value;

    fetch(`/spas/slots/?date=${date}&service_id=${serviceId}`)
      .then(response => response.json())
      .then(data => {
        console.log("Available Slots:", data.slots);
        
        const slotSelect = document.getElementById('time-select');
        slotSelect.innerHTML = '';

        if (data.slots.length === 0) {
          const option = document.createElement('option');
          option.textContent = 'No available slots';
          option.disabled = true;
          option.selected = true;
          slotSelect.appendChild(option);
        } else {
          data.slots.forEach(slot => {
            const option = document.createElement('option');
            option.value = slot.time;
            option.textContent = `${slot.time} - ${slot.is_booked ? 'Booked' : 'Available'} - $${slot.price}`;
            option.disabled = slot.is_booked;
            slotSelect.appendChild(option);
          });
        }
      })
      .catch(error => console.error('Error fetching slots:', error));
  }

  document.getElementById('date-select').addEventListener('change', fetchAvailableSlots);
  document.getElementById('service-select').addEventListener('change', fetchAvailableSlots);

  window.addEventListener('DOMContentLoaded', fetchAvailableSlots);
</script>
{% endblock %}
